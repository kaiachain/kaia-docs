# ネットワーク構成

コア・セルは以下のメンバーで構成される：

- 複数のサブネット（推奨）
- 単一のサブネット

## 複数のサブネットを持つコアセル<a id="a-core-cell-with-multiple-subnets"></a>

DB + AppServerやProxy Web Serversのような一般的なWebサービスでは、2層のサブネットを持つことが推奨されている。 このサブネットの設計は、セキュリティー面でより有利である。

全サーバを管理するための監視サーバも別のレイヤとして必要なので、以下では3レイヤのサブネットを持つコアセルのセットアップ方法について説明する。

3層サブネットの構成は以下の通り：

- CNサブネット
- PNサブネット
- 管理 (Mgmt) サブネット

### CNサブネット<a id="cn-subnet"></a>

CNサブネットはコアセル内のCNサーバーで構成される。 コアセルで稼働するCNは1つだけだが、高可用性のために予備のCNを用意しておく必要がある。 コアセル・ネットワーク（CCN）内のすべてのCNは、コアセルの外から他のCNに接続しようとするため、IP/Portを互いにオープンにしておく必要がある。 (This connection information can be received from Baobab operators.) コアセル内の他のサブネットとの内部通信では、PNサブネットのPNに接続するためにデフォルトポート（32323：デフォルトのKaia P2Pポート番号）を開放する必要がある。 さらに、監視サーバー用のCN監視ポート（61001）や管理用のSSHポート（22）など、他のポートを開く必要があります。 マルチチャンネル機能を使用する場合は、別のポート（32324：デフォルトのマルチチャンネルポート）も開く必要がある。

![CN Subnet](/img/nodes/cn_subnet.png)

| オリジン・サブネット | 対象サブネット        | Ingress                               | Egress |
| :--------- | :------------- | :------------------------------------ | :----- |
| CNサブネット    | PNサブネット        | P2P：32323（マルチチャンネルは32324）             | すべて    |
| CNサブネット    | 管理サブネット        | SSH: 22, モニタリング：61001 | すべて    |
| CNサブネット    | パブリック（インターネット） | 各CNのIPとP2Pポート                         | すべて    |

### PNサブネット<a id="pn-subnet"></a>

PNサブネットは、外部ENに接続するためのサービスを提供するPNサーバーで構成される。

PNサブネットは以下のノードに接続されている：

- コア細胞のCN
- 他のコアセルのPNの一部
- コアセル管理サーバー（管理、監視）
- ENノード

![PN Subnet](/img/nodes/pn_subnet.png)

| オリジン・サブネット | 対象サブネット        | Ingress                               | Egress |
| :--------- | :------------- | :------------------------------------ | :----- |
| PNサブネット    | CNサブネット        | P2P：32323（マルチチャンネルは32324）             | すべて    |
| PNサブネット    | 管理サブネット        | SSH: 22, モニタリング：61001 | すべて    |
| PNサブネット    | パブリック（インターネット） | P2P: 32323            | すべて    |

### 管理サブネット<a id="mgmt-subnet"></a>

Mgmt Subnetは、オペレーターがsshを通してコアセルノードに入るためのゲートウェイサブネットです。 コアセルノードを管理するツールをインストールした監視サーバーや管理サーバーと接続するために、VPNサーバーが必要になる場合がある。

![Management Subnet](/img/nodes/admin_subnet.png)

| オリジン・サブネット | 対象サブネット        | Ingress                                                                                               | Egress |
| :--------- | :------------- | :---------------------------------------------------------------------------------------------------- | :----- |
| 管理サブネット    | CNサブネット        | すべて                                                                                                   | すべて    |
| 管理サブネット    | PNサブネット        | すべて                                                                                                   | すべて    |
| 管理サブネット    | パブリック（インターネット） | VPN (tcp): 443, VPN (udp): 1194 | すべて    |

## 単一のサブネットを持つコアセル<a id="a-core-cell-with-a-single-subnet"></a>

コアセルの1つのサブネットは、開発／テスト目的、あるいは複数のサブネットを作成する困難な状況下で構築される。

すべてのノードは1つのCCサブネットの下にセットアップされる。 CNがP2Pポート（マルチチャンネルオプションの場合は32323、32324）を使ってCNN内の他のCNに接続するためには、ファイアウォールの設定も必要である。 PNのP2Pポートは、ENN（Endpoint Node Network）のENやCNN（Core Cell Network）のPNと接続するために開放される。 さらに、リモートで管理するためには、オプションのVPNと監視サーバーが必要です。

![CC with a Single Subnet](/img/nodes/cc_single_subnet.png)
