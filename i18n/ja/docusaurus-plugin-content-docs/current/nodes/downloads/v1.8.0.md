# v1.8.0

## パッケージダウンロード

### 回転数<a id="rpm"></a>

サイプレス・パッケージ

- [kcnd-v1.8.0-0.el7.x86_64.rpm](https://packages.klaytn.net/klaytn/v1.8.0/kcnd-v1.8.0-0.el7.x86_64.rpm)
- [kpnd-v1.8.0-0.el7.x86_64.rpm](https://packages.klaytn.net/klaytn/v1.8.0/kpnd-v1.8.0-0.el7.x86_64.rpm)
- [kend-v1.8.0-0.el7.x86_64.rpm](https://packages.klaytn.net/klaytn/v1.8.0/kend-v1.8.0-0.el7.x86_64.rpm)

バオバブ・パッケージ

- [kcnd-baobab-v1.8.0-0.el7.x86_64.rpm](https://packages.klaytn.net/klaytn/v1.8.0/kcnd-baobab-v1.8.0-0.el7.x86_64.rpm)
- [kpnd-baobab-v1.8.0-0.el7.x86_64.rpm](https://packages.klaytn.net/klaytn/v1.8.0/kpnd-baobab-v1.8.0-0.el7.x86_64.rpm)
- [kend-baobab-v1.8.0-0.el7.x86_64.rpm](https://packages.klaytn.net/klaytn/v1.8.0/kend-baobab-v1.8.0-0.el7.x86_64.rpm)

共通パッケージ

- [kscnd-v1.8.0-0.el7.x86_64.rpm](https://packages.klaytn.net/klaytn/v1.8.0/kscnd-v1.8.0-0.el7.x86_64.rpm)
- [kspnd-v1.8.0-0.el7.x86_64.rpm](https://packages.klaytn.net/klaytn/v1.8.0/kspnd-v1.8.0-0.el7.x86_64.rpm)
- [ksend-v1.8.0-0.el7.x86_64.rpm](https://packages.klaytn.net/klaytn/v1.8.0/ksend-v1.8.0-0.el7.x86_64.rpm)
- [kbnd-v1.8.0-0.el7.x86_64.rpm](https://packages.klaytn.net/klaytn/v1.8.0/kbnd-v1.8.0-0.el7.x86_64.rpm)
- [kgen-v1.8.0-0.el7.x86_64.rpm](https://packages.klaytn.net/klaytn/v1.8.0/kgen-v1.8.0-0.el7.x86_64.rpm)
- [homi-v1.8.0-0.el7.x86_64.rpm](https://packages.klaytn.net/klaytn/v1.8.0/homi-v1.8.0-0.el7.x86_64.rpm)

### リナックス<a id="linux"></a>

サイプレス・パッケージ

- [kcn-v1.8.0-0-linux-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/kcn-v1.8.0-0-linux-amd64.tar.gz)
- [kpn-v1.8.0-0-linux-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/kpn-v1.8.0-0-linux-amd64.tar.gz)
- [ken-v1.8.0-0-linux-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/ken-v1.8.0-0-linux-amd64.tar.gz)

バオバブ・パッケージ

- [kcn-baobab-v1.8.0-0-linux-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/kcn-baobab-v1.8.0-0-linux-amd64.tar.gz)
- [kpn-baobab-v1.8.0-0-linux-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/kpn-baobab-v1.8.0-0-linux-amd64.tar.gz)
- [ken-baobab-v1.8.0-0-linux-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/ken-baobab-v1.8.0-0-linux-amd64.tar.gz)

共通パッケージ

- [kscn-v1.8.0-0-linux-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/kscn-v1.8.0-0-linux-amd64.tar.gz)
- [kspn-v1.8.0-0-linux-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/kspn-v1.8.0-0-linux-amd64.tar.gz)
- [ksen-v1.8.0-0-linux-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/ksen-v1.8.0-0-linux-amd64.tar.gz)
- [kbn-v1.8.0-0-linux-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/kbn-v1.8.0-0-linux-amd64.tar.gz)
- [kgen-v1.8.0-0-linux-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/kgen-v1.8.0-0-linux-amd64.tar.gz)
- [homi-v1.8.0-0-linux-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/homi-v1.8.0-0-linux-amd64.tar.gz)

### マックオス<a id="macos"></a>

サイプレス・パッケージ

- [kcn-v1.8.0-0-darwin-10.10-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/kcn-v1.8.0-0-darwin-10.10-amd64.tar.gz)
- [kpn-v1.8.0-0-darwin-10.10-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/kpn-v1.8.0-0-darwin-10.10-amd64.tar.gz)
- [ken-v1.8.0-0-darwin-10.10-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/ken-v1.8.0-0-darwin-10.10-amd64.tar.gz)

バオバブ・パッケージ

- [kcn-baobab-v1.8.0-0-darwin-10.10-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/kcn-baobab-v1.8.0-0-darwin-10.10-amd64.tar.gz)
- [kpn-baobab-v1.8.0-0-darwin-10.10-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/kpn-baobab-v1.8.0-0-darwin-10.10-amd64.tar.gz)
- [ken-baobab-v1.8.0-0-darwin-10.10-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/ken-baobab-v1.8.0-0-darwin-10.10-amd64.tar.gz)

共通パッケージ

- [kscn-v1.8.0-0-darwin-10.10-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/kscn-v1.8.0-0-darwin-10.10-amd64.tar.gz)
- [kspn-v1.8.0-0-darwin-10.10-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/kspn-v1.8.0-0-darwin-10.10-amd64.tar.gz)
- [ksen-v1.8.0-0-darwin-10.10-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/ksen-v1.8.0-0-darwin-10.10-amd64.tar.gz)
- [kbn-v1.8.0-0-darwin-10.10-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/kbn-v1.8.0-0-darwin-10.10-amd64.tar.gz)
- [kgen-v1.8.0-0-darwin-10.10-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/kgen-v1.8.0-0-darwin-10.10-amd64.tar.gz)
- [homi-v1.8.0-0-darwin-10.10-amd64.tar.gz](https://packages.klaytn.net/klaytn/v1.8.0/homi-v1.8.0-0-darwin-10.10-amd64.tar.gz)

### ウィンドウズ<a id="windows"></a>

- 未対応

## リリースノート

Klaytn v1.8.0にはプロトコルのアップグレードが含まれており、イーサリアムのハードフォークのような互換性のない変更が生じます。 すべてのノードは、目標ブロック番号の前にこのバージョンにアップグレードする必要がある。

予定されているハードフォークのスケジュールは以下の通り：

- バオバブテストネット（バオバブブロック番号86513895、予定日3月24日）
  - EthTxType hard fork: #86513895
    (IstanbulEVM and LondonEVM hard fork already applied on Baobab)

- サイプレス・メインネット（サイプレス・ブロック番号86816005、予定日：3月31日）
  - IstanbulEVMハードフォーク：#86816005
  - LondonEVMハードフォーク：#86816005
  - EthTxType ハードフォーク：#86816005

**注**：イスタンブールEVMハードフォークでは、EVMオペコードのガス代とAPIの使用方法が変更された。 これらの変更により、既存の契約が期待通りに機能しない可能性がありますので、本記事の【プロトコル更新に関する注意事項】をご参照ください\*\*。

## プロトコルのアップグレード機能

- Ethereumトランザクションタイプをサポートする新しいトランザクションタイプを可能にするEthTxTypeハードフォークを導入：TxTypeEthereumAccessList`と `TxTypeEthereumDynamicFee\` (#1142 #1158)

## v1.8.0の新機能

- `EthereumTxTypeEnvelope`を定義しました (#1171)
- 新しいトランザクションタイプにEIP-2930署名者とロンドン署名者を実装 (#1142 #1158)
- Ethereum APIフォーマットをサポートするために`eth`名前空間APIを導入した (#1076 #1077 #1083 #1088 #1093 #1095 #1121 #1123 #1124 #1127 #1129 #1130 #1134 #1172)
- 新しい `klay` 名前空間 API を追加しました：klay_maxPriorityFeePerGas`、`klay_createAccessList`、`klay_feeHistory\` (#1156)
- Ethereum APIフォーマットの互換性を無効にする`rpc.eth.noncompatible`フラグを導入しました。
- ブロックヘッダAPIの戻り値に`baseFeePerGas`フィールドを追加しました (#1183)
- 実装状態のスナップショット (#1112 #1116 #1152 #1154 #1155 #1173 #1174)
- クラッシュ耐性のためにデーモンの自動再起動を実装 (#1101)

### 改善点

- ノード起動時のアカウントマネージャのロック解除タイミングを調整 (#1141)
- 1回の投票で複数のバリデータを追加/削除できるようにした (#1110)
- ガバナンス投票APIの検証ロジックを強化 (#1109)
- blockchain.goにおけるミューテックスの統一 (#1099)

### 修正

- ガバナンスキャッシュの初期化のバグを修正 (#1168)
- `klay_gasPrice` APIが適切なガス価格値を返すように修正 (#1211)
- トランザクションフィールドの更新時に発生する競合状態の問題を修正 (#1091)
- ディープリターンオブジェクトが引き起こすコールトレーサーパニックを修正 (#1203)

## ETC

- サイプレスネットワークのハードフォークブロック番号を設定 (#1230)
  - IstanbulEVMハードフォーク：86816005
  - LondonEVMハードフォーク：86816005
  - EthTxTypeハードフォーク：86816005
- Baobabネットワークのハードフォークブロック番号を設定しました (#1230)
  - EthTxTypeハードフォーク：86513895

# ハードフォークに関する注意事項

新バージョンは、現在サービス中のKlaytn DAppsにも影響することが予想されますので、サービス運営者や開発者の方は、以下の説明と合わせて、シリーズ「イーサリアム同等を目指して」 [#1](https://medium.com/klaytn/toward-ethereum-equivalence-1-introducing-klaytn-v1-8-0-971911be7ff9) [#2](https://medium.com/klaytn/toward-ethereum-equivalence-2-changes-in-precompiled-contract-addresses-a314d9db2927) [#3](https://medium.com/klaytn/toward-ethereum-equivalence-3-supporting-ethereum-apis-ab16f66008) [#4](https://medium.com/klaytn/toward-ethereum-equivalence-4-ethereum-transaction-types-a5aefb18e5bf) も一読されることをお勧めします。

## DAppサービスプロバイダー向け

### 古いスマートコントラクトでガス欠エラーが発生する可能性があります。

IstanbulEVMハードフォークEVMには、オペコードのガスコストの変更が含まれています（[Klaytn v1.7.0 リリースノート](https://github.com/klaytn/klaytn/releases/tag/v1.7.0)の「プロトコルのアップグレード機能」を参照してください）。 フォールバックのような限られたガスコストを必要とする機能を多く契約していた場合、このガスコストの変化によってガス欠が発生する可能性がある。 これまでのところ、OpenZeppelinのBaseAdminUpgradeabilityProxy.solとBaseUpgradeabilityProxy.solを継承したアップグレード可能なコントラクトが、Proxy.solと同じフォールバック関数を実装している場合に問題があると判断しています。 同様の機能が実装されているかどうか、ご確認ください。 また、ガス代は常に変動する可能性があるため、ログを印刷する以外のフォールバックで負荷の高いアクションを使用することは控えてください。 ([reference](https://consensys.net/diligence/blog/2019/09/stop-using-soliditys-transfer-now/))。

### プリコンパイル契約のアドレスが一部変更されます。

vmLog(0x09)、feePayer(0x0a)、validateSender(0x0b)のアドレスは、イーサリアムのコンパイル済みコントラクトとの互換性を確保するために転送される。 ハードフォーク後にデプロイされたコントラクトにのみ適用され、それ以前にデプロイされたコントラクトは引き続き使用可能である。 詳細は【イーサリアムの同等性を目指して #2 - コンパイル済みコントラクトアドレスの変更](https://medium.com/klaytn/toward-ethereum-equivalence-2-changes-in-precompiled-contract-addresses-a314d9db2927)をご参照ください。

### 新しいトランザクション・タイプをサポートするために、ケーバーをv1.8.0以上にアップデートする。

`EthTxType`のハードフォークにより、新しい取引タイプを使用できるようになる。 他のアカウントのトランザクションにアクセスする必要があるサービスで新しいトランザクション形式が必要な場合は、必ずケーバーをv1.8.0 ([js](https://www.npmjs.com/package/caver-js/v/1.8.0), [java](https://search.maven.org/artifact/com.klaytn.caver/core/1.8.0/jar))以上にアップデートしてください。 新しいタイプの詳細については、[Toward Ethereum Equivalence #4 - Ethereum transaction types](https://medium.com/klaytn/toward-ethereum-equivalence-4-ethereum-transaction-types-a5aefb18e5bf)を参照してください。

## ENオペレーター向け

### `eth`と`klay` APIの新しい戻り値

以前は、`eth`名前空間を使ってAPIコールを行うことができ、`klay`名前空間と同じように動作した。 しかし、v1.8.0 以降、`eth` 名前空間 API は Ethereum API のリターンフォーマットを採用する。 詳しくは[Toward Ethereum Equivalence #3 - Supporting Ethereum API formats](https://medium.com/klaytn/toward-ethereum-equivalence-3-supporting-ethereum-apis-ab16f66008)をご覧ください。 旧バージョンの動作にこだわって `klay` のように `eth` を使いたい場合は、`--rpc.eth.noncompatible` init オプションを追加するだけでよい。

### EN のデフォルトの許可 API リストに `eth` を追加する。

`eth`名前空間APIがENでサポートされ、`eth`がデフォルトの許可リストに追加された。 `kend.conf` ファイル内の `RPC_API` と `WS_API ` の設定に `eth` を追加する必要がある。 `net`、hardhatのようなイーサリアムツールで使用される`web3` APIもリストに追加された。 要約すると、v1.8.0のデフォルトのAPIホワイトリストには以下のものが含まれる：RPC_API="klay,net,eth,web3"、WS_API="klay,net,eth,web3"
